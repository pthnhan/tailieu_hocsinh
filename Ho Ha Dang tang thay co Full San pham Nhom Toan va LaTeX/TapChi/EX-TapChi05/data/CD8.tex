%\chapter{Lời giải từ trên trời rơi xuống}

\section{Lời giải từ trên trời rơi xuống}
\begin{center}
	\textbf{\color{violet}{Tạp chí Pi tháng 6, tháng 7 năm 2018}}
\end{center}
\noindent Có lần, khi còn ngồi trên ghế nhà trường phổ thông, tôi tình cờ gặp bài toán sau (xem cuốn "Đề thi vô địch $19$ nước. Tập 02", NXB Hải Phòng, bài 20.9):


\begin{bt}[Olympic Toán  Romania 1978]
	Chứng minh rằng tồn tại hàm số $f: \mathbb{N}^*\longrightarrow \mathbb{N}^*$ thỏa mãn: \[f\left(f\left(n\right)\right)=n^2,\tag{1}\]
	với mọi số nguyên dương $n$.
\end{bt}
\loigiai{ Giả sử $n_1=2,n_2=3,n_3=5,\ldots$ là dãy tăng các số không chính phương.\\
Đặt $n_{k,m}=\left(n_k\right)^{2^m}$, trong đó $k\in\mathbb{N}^*$ và $m\in\mathbb{N}$. \\
Khi đó, $n_{k,m+1}=\left(n_{k,m}\right)^2$ và ứng với mỗi giá trị $n>1$, có duy nhất cặp số $k,m$ sao cho $n=n_{k,m}$.\\
Xây dựng hàm số $f: \mathbb{N}^*\longrightarrow \mathbb{N}^*$  như sau:
$$f(1)=1,\, f\left(n_{k,m}\right)=\begin{cases} n_{k+1,m}\hspace{2cm}\text{nếu k lẻ} \\  n_{k-1,m+1}\hspace{1.5cm}\text{nếu k chẵn}   \end{cases}$$
trong đó, $k\in\mathbb{N}^*$ và $m\in\mathbb{N}$.\\
Khi đó, dễ thấy $f\left(f\left(n\right)\right)=n^2,\,\forall n\in\mathbb{N}^*$.}
Đọc xong, choáng; cảm thấy lời giải như "từ trên trời rơi xuống". Nói cách khác, có cảm giác rằng nếu không phải là người nghĩ ra bài toán trên thì phải có một linh cảm toán học thật tốt mới tìm ra được một lời giải như thế. Vì quả thực, trong lúc loay hoay tìm cách xây dựng một hàm số cụ thể để minh chứng cho sự khác rỗng của tập hợp các hàm số $f$ thỏa mãn phương trình hàm $(1)$, tôi không hề nghĩ tới hàm số có cấu trúc phức tạp như thế. Tuy nhiên, vì muốn học nên sau khi hít hà một số hữu hạn hơi để trấn tĩnh lại, liền quyết một tâm tìm hiểu, khám phá sợi dây logic kết nối lời giải ấy với các giả thiết của bài đã ra. Bình tĩnh ngắm lại lời giải, hiểu ngay do đâu mà chọn $f(1)=1$, vì để thấy điều ấy chỉ cần trong $(1)$, cho $n=1$. Khi đó, sẽ được $$f\left(f\left(1\right)\right)=1.$$
Suy ra, $f\left(1\right)^2=f\left(1\right)$; dẫn tới $f(1)=1$ (vì $f\left(1\right)\in\mathbb{N}^*$).\\
Ngắm lời giải kĩ thêm một số chút nữa, hẳn bạn sẽ như tôi khi đó, nhận ra rằng ý tưởng của lời giải trên là xây dựng hàm $f$ dựa trên giá trị của hàm tại các điểm không chính phương.\\
Hiển nhiên, ý tưởng đó chỉ có thể xuất hiện khi khai thác các giả thiết, ta phát hiện được mối liên hệ giữa giá trị của hàm tại các điểm chính phương và tại các điểm không chính phương. Nghĩ thế và để ý rằng, một trong những công dụng của kĩ thuật "lấy $f$" cả hai vế của phương trình (ẩn $f$) dạng $$F\left(f\left(x\right)\right)=g(x)$$
là cho thông tin về giá trị của hàm $f$ tại các điểm có "dạng $g(x)$"( tức tại các điểm $y$ mà tồn tại $x$ sao cho $y=g(x)$), hẳn bạn sẽ quyết định lấy $f$ cả hai vế của phương trình $(1)$, để tìm thông tin về giá trị của $f$ tại các điểm chính phương. Khi đó, sẽ được $$f\left(n^2\right)=\left(f\left(n\right)\right)^2,$$
với mọi $n$ nguyên dương.\\
Từ đó, hiển nhiên có \[f\left(n^{2^k}\right)=\left(f\left(n\right)\right)^{2^k},\tag{2}\]
với mọi $k,n$ nguyên dương.\\
Tới đây, với lưu ý rằng, nếu $n$ là một số chính phương, sẽ có duy nhất số không chính phương $m$ và có duy nhất số nguyên dương $k$ sao cho $n=m^{2^k}$, đương nhiên bạn sẽ thấy giá trị của $f$ tại các điểm chính phương được hoàn toàn xác định qua giá trị tại các điểm không chính phương.\\
Thế là rõ, từ đâu mà ra ý tưởng của lời giải trên đây!\\
Vấn đề còn lại bây giờ, là làm sao mới được các thông tin về giá trị của $f$ tại các điểm không chính phương. Nhìn lại phương trình hàm $(1)$ hẳn bạn cũng như tôi, thấy nản; vì chẳng thể lấy le lói tia sáng nào cho việc có thể tìm ra các thông tin mang tính định lượng cho giá trị của $f$ tại các điểm không chính phương. Phải chăng đây chính là điểm khó không thể vượt qua, khiến người ta không thể giải $(1)$, mà chỉ có thể nghĩ tới việc tìm hiểu sự tồn tại của hàm số thỏa mãn $(1)$, như đã thể hiện trong yêu cầu của bài ra?\\
Thôi thì, không thể tìm ra các thông tin mang tính định lượng thì cố tìm đôi thông tin mang tính định tính, đặng có chổ bấu víu để lý giải phần nào hoặc cảm nhận được điều gì đã giúp người ta tìm ra hàm $f$ trong lời giải trên đây. Theo hướng nghĩ này, điều đơn giản nhất có thể nghĩ tới là tìm cách khoanh vùng nơi cư trú có thể của giá trị của $f$ tại các điểm không chính phương.\\
Tới thời điểm này, trong ý nghĩ, trong các suy luận của mình, chúng ta đã mặc nhiên phân chia các số nguyên dương thành hai loại: chính phương và không chính phương. Do thể, ở bước sơ khai, khi có ý định khoanh vùng nêu trên, tôi liền nghĩ tới việc tìm câu trả lời cho câu hỏi: giá trị của $f$ tại các điểm không chính phương là số chính phương hay số không chính phương?\\ 
Để tiện cho việc trình bày tiếp theo, ta kí hiệu $CP$ là tập các số chính phương và $\overline{CP}$ là tập các số không chính phương.\\
Rõ ràng, với $n\in \overline{CP}$, chỉ có thể xảy ra một trong hai khả năng: $f(n)\in\overline{CP}$ hoặc $f(n)\in CP$. Vấn đề đặt ra là liệu có thể có $f(n)\in\overline{CP}$ với mọi $n\in\overline{CP}$, hoặc $f(n)\in CP$ với mọi $n\in\overline{CP}$, hay sẽ tồn tại $n\in CP$ sao cho $f(n)\in\overline{CP}$ và đồng thời cũng tồn tại $n\in\overline{CP}$ sao cho $f(n)\in CP$? Để biết, không có con đường nào khác ngoài con đường cầm bút, "cắm mặt" vào giấy, xét hai khả năng sau:\\
$\bullet$ \textit{Khả năng 1:} $f(n)\in\overline{CP}$.\\
Giả sử $f(n)=m$, với $m\in\overline{CP}$. Khi đó, theo $(1)$, ta có $$f\left(f\left(n\right)\right)=f\left(m\right)=n^2.$$
Tôi đã cố gắng "đào bới" tiếp và không thu được thêm thông tin nào hữu ích cho điều mình đang quan tâm.\\
$\bullet$ \textit{Khả năng 2:} $f(n)\in CP$.\\
Giả sử $f(n)=m^{2^k}$, với $m\in\overline{CP}$ và $k\in\mathbb{N}^*$.\\
Khi đó, theo $(1)$ và $(2)$, ta có: $$n^2=f\left(f\left(n\right)\right)=f\left(m^{2^k}\right)=\left(f\left(m\right)\right)^{2^k}.$$
Suy ra $n=\left(f\left(m\right)\right)^{2^{k-1}}$.\\
Từ đó, vì $n\in\overline{CP}$ nên phải có $2^{k-1}=1$ hay $k=1$. Như vậy, nếu $f(n)\in CP$ thì $f(n)=m^2$, với $m\in\overline{CP}$.\\
Gắng "moi" thêm nữa, ta được: $$n^2=f\left(f\left(n\right)\right)=f\left(m^2\right)=\left(f\left(m\right)\right)^2.$$
Dẫn tới $f(m)=n.$\\
Tới đây, tôi lại gặp "bế tắc" như khi xét khả năng $1$.\\
Mọi việc dường như "dã tràng xe cát biển Đông", vì với các thông tin thu được, ta chỉ có thể khẳng định với $n\in\overline{CP}$ thì $f(n)$ có thể là số không chính phương cũng có thể là số chính phương; nghĩa là, $f(n)\in\mathbb{N}^*$ với mọi $n\in\overline{CP}$!\\
Còn nhớ lúc đó, ngẩn ngơ nhìn lại thành quả của mình trước khi vo viên tờ giấy nháp cho vào thùng rác, tôi tí la hoảng lên vì chợt phát hiện ra rằng, các kết quả thu được khi xét hai khả năng có một đặc trưng rất thú vị. Đó là với $n\in\overline{CP}$, nếu $f(n)$ là một số chính phương đó phải là bình phương đúng của một số không chính phương; và với $m,n\in\overline{CP}, m\not=n$, nếu $f(m)=n$ thì $f(n)=m^2$, nếu $f(m)=n^2$ thì $f(n)=m$. Đặc trưng này dẫn ta tới ý nghĩ, phải chăng sự hiện diện của $f$ đã tạo ra trong tập $\overline{CP}$ các cặp số mà hai số nằm trong cùng cặp khi và chỉ khi $f$ tại số này bằng số kia hoặc bình phương của số kia. Nói một cách "màu mè": \\
\textit{"Với sự hiện diện của f, ta có thể tô màu tất cả các số chính phương sao cho mỗi số được tô bởi một màu, mỗi màu được dùng để tô đúng hai số, và hai số $m,n$ được tô cùng màu khi và chỉ khi $f(m)=n$ hoặc $f(m)=n^2$."(*)}\\
Hiển nhiên, việc cần làm tiếp theo là kiểm tra tính đúng của ý nghĩ vừa nêu trên.\\
Giả sử, số $a\in\overline{CP}$ được tô màu xanh. Khi đó, theo trên, tồn tại $b\in\overline{CP}, b\not=a$, sao cho $b$ cũng được tô màu xanh. Tiếp theo, giả sử tồn tại $c\in\overline{CP}, c\not\in\{a;b\}$, sao cho $c$ cũng được tô màu xanh.\\
- Nếu $b$ được tô màu xanh, vì $f(a)=b$ thì do $b\not= c$ nên phải có $f(a)=c^2$. Tuy nhiên, điều này không thể xảy ra do $f(a)$ không thể vừa thuộc $CP$, vừa thuộc $\overline{CP}$.\\
- Nếu $b$ được tô xanh vì $f(a)=b^2$ thì do $c\not= b^2$( vì $c\in\overline{CP}$) nên phải có $f(a)=c^2$; dẫn tới $b^2=c^2$, là điều không thể, do $b\not= c$.\\
Việc xét trên đây cho thấy không thể tồn tại $c\in\overline{CP}, c\not\in\{a;b\}$, sao cho $c$ cũng được tô màu xanh. Vì thế, $(*)$ là một khẳng định đúng.\\
Vậy là, ta đã tìm được một kết quả đẹp, mà bằng ngôn từ Toán học, có thể phát biểu như sau:\\
\textit{" Hàm $f$ thỏa mãn $(1)$ tạo ra một phân hoạch tập $\overline{CP}$ thành các tập con, mỗi tập con có hai phần tử và hai phần tử $m,n$ thuộc cùng một tập con khi và chỉ khi $f(m)=n$ hoặc $f(m)=n^2$."}\\
Kết quả trên chẳng những cho thấy điểm tựa để tìm ra hàm $f$ trong lời giải bài toán $1$ trên đây, mà còn cho thấy khả năng giải được của phương trình hàm $(1)$. Để chứng minh khả năng vừa nêu, việc cần làm là kiểm tra hàm $f:\mathbb{N}^*\longrightarrow \mathbb{N}^*$ được xây dựng bằng cách sau đây có thỏa mãn hay không phương trình hàm $(1)$:\\
- Đặt $f(1)=1$;\\
- Phân hoạch tập $\overline{CP}$ thành các tập con, mỗi tập con gồm hai phần tử: $$\overline{CP}=\bigcup\limits_{i=1}^{\infty}\{m_i;n_i\},\{m_i;n_i\}\cap\{m_j;n_j\}=\varnothing$$
với mọi $j>i\geq 1$;\\
- Trong mỗi tập con $\{m_i,n_i\}$, đặt $f\left(m_i\right)=n_i$ và $f\left(n_i\right)=m_i^2$ hoặc $f\left(m_i\right)=n_i^2$ và $f\left(n_i\right)=m_i$;\\
- Với $n\in CP$ và $n>1$, biểu diễn $n$ dưới dạng $$n=m^{2^k}, m\in\overline{CP} \, \text{và}\, k\in\mathbb{N}^*.$$
(Lưu ý: Biểu diễn trên là duy nhất).\\
Đặt $f(n)=\left(f(m)\right)^{2^k}.$\\
Xin nhường bạn đọc việc chứng minh hàm $f: \mathbb{N}^*\longrightarrow \mathbb{N}^*$ được xây dựng như trên thỏa mãn phương trình hàm $(1)$.\\
Thế là, với mong muốn tìm hiểu nơi và qui trình "rơi xuống" của lời giải bài toán $1$, thật bất ngờ ta đã giải được bài toán với yêu cầu mạnh hơn hẳn bài đã ra:

{\bf$\bullet$ Khẳng định 1:} Cho hàm số $g: \mathbb{N}^\star\longrightarrow \mathbb{N}$ thỏa mãn điều kiện $n<g(n)$ với mọi số nguyên dương $n>1$. Khi đó $\overline{G}$ là tập khác rỗng.\\
Dễ thấy, nếu $g(1)>1$ thì $1\in\overline{G}$, và do đó $\overline{G}\ne\varnothing$.\\
Trường hợp $g(1)=1$, do phải có $2\le n<g(n)$ với mọi $n>1$ (theo giả thiết), nên $g(n)\ne 2$ với mọi $n\in \mathbb{N}^\star$; nghĩa là, $2\in \overline{G}$. Vì thế $\overline{G}\ne\varnothing$.

{\bf$\bullet$ Khẳng định 2:} Cho đơn ánh $g: \mathbb{N}^\star\longrightarrow \mathbb{N}^\star$ thỏa mãn điều kiện: $n<g(n)$ với mọi số nguyên dương $n>1$. Khi đó, với mỗi số $m>1$ thuộc $G$, đều tồn tại duy nhất cặp số $(q;k)$, với $q\in \overline{G}$ và $k\in\mathbb{N}^\star$, sao cho $m=g^k(q)$.
\cm Theo khẳng định 1, $\overline{G}\ne\varnothing$. Lưu ý rằng, nếu $g(1)>1$ thì $1\notin G$ (do $g(n)>1$ với mọi $n>1$). Trường hợp $g(1)=1$, hiển nhiên có: nếu $u>1, u=g(v)$ và $v\in G$ thì $v>1$.

Từ đó, do $n<g(n)$ với mọi $n>1$, suy ra ta luôn có:
\[(u>1, u=g(v)\ \text{và}\  v\in G)\Rightarrow 1<v<u.\tag{7}\]   
Xét số nguyên dương $m>1$ tùy ý thuộc $G$.\\
- Vì $m\in G$ nên tồn tại $m_1\in\mathbb{N}^\star$ sao cho $m=g(m_1)$.\\
Nếu $m_1\in G$ thì theo (7), $1<m_1<m$. Vì $m_1\in G$ nên tồn tại $m_2\in \mathbb{N}^\star$ sao cho $m_1=g(m_2)$.\\
Nếu $m_2\in G$ thì theo (7), $1<m_2<m_1$.\\
Tiếp tục quá trình "nếu" trên đây, ta sẽ được dãy số nguyên dương \[m>m_1>m_2>\cdot\cdot\cdot \tag{8}\] 
thỏa mãn $m_i=g(m_{i+1})$ với mọi $i=0, 1, 2,\ldots$ (quy ước $m_0=m$).

Vì số nguyên dương nhỏ hơn $m$ và thuộc $G$ là hữu hạn nên dãy (8) là hữu hạn; nghĩa là quá trình "nếu" phải dừng lại một bước nào đó. Rõ ràng, quá trình "nếu" chỉ phải dừng lại khi số thu được là một số thuộc $\overline{G}$.\\
Những điều vừa trình bày trên đây cho thấy, tồn tại một số nguyên dương $k$ sao cho ta có thểm tìm được $k$ số nguyên dương $m_1,\ldots,m_k$ thỏa mãn $m_k\in \overline{G}$ và \[m_i=g(m_{i+1})\ \text{với mọi}\ i=0,1,2 ,\ldots, k_1 \tag{9}\]
(quy ước $m_0=m$).\\
Rõ ràng từ (9), ta có $m=g^k(m_k)$.\\
Như vậy, ta đã chứng tỏ được rằng, tồn tại cặp số $(q,k)$, với $q\in\overline{G}$ và $k\in \mathbb{N}^\star$, sao cho $m=g^k(q)$.\\
- Giả sử tồn tại hai cặp số $(q,k)$ và $(p,l)$, với $q,p\in\overline{G}$ và $k,l\in \mathbb{N}^\star$, sao cho \[m=g^k(q)=g^l(p). \tag{10}\]  
Không mất tính tổng quát, có thể giả sử $k\le l$. Khi đó có thể viết (10) dưới dạng: \[g^k(q)=g^k(g^{l-k}(p)).\tag{11}\]
Vì $g$ là đơn ánh nên từ (11) suy ra $q=g^{l-k}(p)$. Từ đó, vì $q\in\overline{G}$ nên phải có $l-k=0$, hay $l=k$, kéo theo $p=q$.\\
Như thế ta đã chứng tỏ được rằng, chỉ có duy nhất cặp số $(q,k)$, với $q\in \overline{G}$ và $k\in\mathbb{N}^\star$, sao cho $m=g^k(q)$.\\
Khẳng định 2 được chứng minh.\\
Khẳng định trên có một hệ quả hiển nhiên sau:\\
{\bf$\bullet$ Hệ quả 1:} Cho $g: \mathbb{N}^\star\longrightarrow\mathbb{N}^\star$ là một hàm số thỏa mãn đầy đủ các điều kiện nêu trong Khẳng định 2. Khi đó:\\
- Nếu $g(1)=1$ thì với mọi số nguyên dương $m>1$, đều tồn tại duy nhất cặp số $(q,k)$, với $q\in \overline{G}$ và $k\in\mathbb{N}^\star$, sao cho $m=g^k(q)$.

- Nếu $g(1)>1$ thì mỗi số nguyên dương $m$ đều tồn tại duy nhất cặp số $(q,k)$, với $q\in \overline{G}$ và $k\in\mathbb{N}^\star$, sao cho $m=g^k(q)$.\\
Việc chứng minh hệ quả xin dành cho bạn đọc.\\ 
{\bf$\bullet$ Khẳng định 3:} Cho $g: \mathbb{N}^\star\longrightarrow\mathbb{N}^\star$ có các tính chất sau:
\begin{enumerate}
	\item $n<g(n)$ với mọi $n>1$.
	\item $g$ là một đơn ánh từ $\mathbb{N}^\star$ đến $\mathbb{N}^\star$.
	
\end{enumerate}
Giả sử $f: \mathbb{N}^\star\longrightarrow\mathbb{N}^\star$ là hàm số thỏa mãn (3) với mọi $n$ nguyên dương.\\
Khi đó, với mỗi số $u\in \overline{G}$, tồn tại duy nhất số $v\in\overline{G}$ sao cho hoặc $f(u)=v$ và $f(v)=g(u)$, hoặc $f(u)=g(v)$ và $f(v)=u$.
\cm Theo khẳng định 1, $\overline{G}\ne \varnothing$.\\
Xét số $u\in\overline{G}$ tùy ý. Xảy ra một trong hai trường hợp sau:
+ Trường hợp 1: $f(u)\in \overline{G}$. Khi đó, hiển nhiên tồn tại duy nhất số $v\in\overline{G}$ sao cho $f(u)=v$ và $$f(v)=f(f(u))=g(u).$$
+ Trường hợp 2: $f(u)\in G$.\\
Trước hết ta chứng minh $f(u)>1$.\\
Thất vậy, giả sử ngược lại, $f(u)=1$. Khi đó, $1\in G$. Do đó, $u>1$ và $g(1)=1$. Suy ra \[g(u)>1. \tag{12}\]
Trong (3) cho $n=u$, ta được:
$$g(u)=f(f(u))=f(1).$$
Kết hợp với (12), suy ra $f(1)>1$. Do đó 
\[g(f(1))>f(1).\tag{13}\]
Mặt khác, trong (3) cho $n=1$, ta được:
$$f(f(1))=g(1)=1.$$
Suy ra, $g(f(1))=f(1)$, mâu thuẫn với (13).\\ Mâu thuẫn nhận được cho ta điều muốn chứng minh.\\
Vì thế theo khẳng định 2, tồn tại duy nhất cặp số $(v,l)$, với $v\in\overline{G}$ và $l\in\mathbb{N}^\star$, sao cho \[f(u)=g^l(v).\tag{14}\]
Lấy $f$ cả hai vế của (3), ta được \[f(g(n))=g(f(n)). \tag{15}\]
với mọi $n$ nguyên dương.\\
Từ (15) bằng quy nạp theo $k\in\mathbb{N}^\star$, dễ dàng chứng minh được 
$$f(g^k(n))=g^k(f(n)),$$
với mọi $k,\ n$ nguyên dương.\\
Vì thế lấy $f$ cả hai vế (14) ta được
$$g(u)=g^l(f(v)).$$
Từ đó, do $g$ là đơn ánh, suy ra \[u=g^{l-1}(f(v)). \tag{16}\]
Vì $u\in\overline{G}$ nên từ (16) suy ra phải có  $l-1=0$, hay $l=1$. Vì thế, ta có $$f(u)=g(v)\ \text{và}\ f(v)=u.$$
Vậy tóm lại, với $u$ tùy ý thuộc $\overline{G}$, tồn tại duy nhất $v\in\overline{G}$ sao cho hoặc $f(u)=v$ và $f(v)=g(u)$, hoặc $f(u)=g(v)$ và $f(v)=u$. Khẳng định 3 được chứng minh.\\
Từ khẳng định trên hiển nhiên suy ra:\\
{\bf$\bullet$ Hệ quả 2:} Với các giả thiết như ở Khẳng định 3, ta có thể tô màu tất cả các số thuộc $\overline{G}$ sao cho mỗi số được tô một màu, mỗi màu được dùng để tô cho đúng hai số và hai số $u,\ v$ được tô cùng màu khi và chỉ khi $f(u)=v$ và $f(v)=g(u)$, hoặc $f(u)=g(v)$ và $f(v)=u$.\\
Bạn đọc hãy tự chứng minh Hệ quả trên.\\
Bằng ngôn ngữ thuần túy Toán học, có thể phát biểu lại Hệ quả 2 như sau:\\

{\bf Hệ quả 2':} Với các giả thiết như ở Khẳng định 3, ta có thể phân hoạch tập $\overline{G}$ thành các tập con, mỗi tập con gồm hai phần tử và hai phần tử $u,\ v$ thuộc cùng một tập con khi và chỉ khi $f(u)=v$ và $f(v)=g(u)$, hoặc $f(u)=g(v)$ và $f(v)=u$.

Các khẳng định, cùng các Hệ quả trên đây là điểm tựa giúp ta xây dựng và giải quyết các bài toán dưới đây.
%\setcounter{bt}{2}
\bt Cho hàm số $g: \mathbb{N}^\star\longrightarrow\mathbb{N}^\star$ có các tính chất sau:
\begin{enumerate}[i/]
	\item $n<g(n)$ với mọi $n>1$.
	\item $g$ là một đơn ánh từ $\mathbb{N}^\star$ đến $\mathbb{N}^\star$.
	
\end{enumerate}
Hỏi có tồn tại hay không hàm số $f: \mathbb{N}^\star\longrightarrow\mathbb{N}^\star$ thỏa mãn 
$$f(f(n))=g(n),$$
với mọi $n$ nguyên dương.\\
Dễ thấy theo Hệ quả 2', không thể có một hàm số $f$ thỏa mãn yêu cầu bài toán, nếu $\overline{G}$ là tập hữu hạn và có một số lẻ phần tử. Trường hợp ngược lại, khi $\overline{G}$ là tập vô hạn hoặc tập hữu hạn và có một số chẵn phần tử, ta không chỉ có thể chứng minh được sự tồn tại của hàm số $f$ thoả mãn yêu cầu bài toán (bằng cách chỉ ra một hàm số $f$ củ thể) mà  còn có thể tìm được tất cả các hàm số $f$ như vậy. Nói cách khác ta có thể giải được các bài toán sau:
\bt Cho hàm số $g: \mathbb{N}^\star\longrightarrow\mathbb{N}^\star$ có các tính chất sau:
\begin{enumerate}[i/]
	\item $n<g(n)$ với mọi $n>1$.
	\item $g$ là một đơn ánh từ $\mathbb{N}^\star$ đến $\mathbb{N}^\star$.
	\item Tập hợp $\overline{G}=\{m\in\mathbb{N}^\star| \forall n\in\mathbb{N}^\star,\ m\ne g(n)\}$ là một tập hữu hạn và có một số chẵn các phần tử.
\end{enumerate}
Hãy tìm tất cả các hàm số số $f: \mathbb{N}^\star\longrightarrow\mathbb{N}^\star$ thỏa mãn $f(f(n))=g(n),$ với mọi $n$ nguyên dương.
\bt Cho hàm số $g: \mathbb{N}^\star\longrightarrow\mathbb{N}^\star$ có các tính chất sau:
\begin{enumerate}[i/]
	\item $n<g(n)$ với mọi $n>1$.
	\item $g$ là một đơn ánh từ $\mathbb{N}^\star$ đến $\mathbb{N}^\star$.
	\item Tập hợp $\overline{G}=\{m\in\mathbb{N}^\star| \forall n\in\mathbb{N}^\star,\ m\ne g(n)\}$ là một tập vô hạn các phần tử.
\end{enumerate}
Hãy tìm tất cả các hàm số số $f: \mathbb{N}^\star\longrightarrow\mathbb{N}^\star$ thỏa mãn $$f(f(n))=g(n),$$ với mọi $n$ nguyên dương.

Các bài toán vừa nêu trên có thể được xem là các bài tập lý thuyết, là các "cỗ máy cái" sinh ra các bài tập cụ thể, dùng cho các mục đích khác nhau. Bằng cách chọn các hàm số $g$ cụ thể, thỏa mãn các yêu cầu đã nêu trong bài toán trên, bạn sẽ có được các bài toán nhỏ nhắn, có mức độ dễ thương theo ý muốn. Chẳng hạn các hàm số $g(n)=n+1987,\ g(n)=1993\cdot n^{1945}$, hay $g(n)=n+2$ là các hàm số thỏa mãn các điều kiện a) và b) trong ba bài toán nêu trên; vì thế, căn cứ vào lực lượng của tập $\overline{G}$ ứng với mỗi hàm số $g$, trong ba hàm số vừa nêu, ta có thể có các bài tập xinh xắn sau:

{\bf Bài tập 1.} Chứng minh rằng không tồn tại hàm số $f$ xác định trên tập số nguyên dương, lấy giá trị trong tập số nguyên dương và thỏa mãn $$f(f(n))=n+1987,$$ với mọi số nguyên dương $n$.

{\bf Bài tập 2.} Chứng minh rằng tồn tại hàm số $f$ xác định trên tập số nguyên dương, lấy giá trị trong tập số nguyên dương và thỏa mãn $$f(f(n))=1993\cdot n^{1945},$$ với mọi số nguyên dương $n$.

{\bf Bài tập 3.} Tìm tất cả các hàm số $f$ xác định trên tập số nguyên dương, lấy giá trị trong tập số nguyên dương và thỏa mãn $$f(f(n))=n+2,$$ với mọi số nguyên dương $n$.\\
Bài tập 3 là một bài toán đã được đăng tải trong mục Đề ra kỳ này của Tạp chí TH và TT, thời "Xa vắng". Bài tập 2 là Bài 3 trong Đề thi họa sịnh giỏi quốc gia lớp 12 THPT, môn toán, năm 1993. Với bài tập 1, bạn hãy tự kiểm chứng rằng kết luận của cách giải bài tập đó không thay đổi khi thay "tập số nguyên dương" bởi "tập số tự nhiên". Nói cách khác có thể coi bài tập 1 và bài tập sau là một:\\
{\bf Bài tập 1'.} Chứng minh rằng không tồn tại hàm số $f$ xác định trên tập số tự nhiên, lấy giá trị trong tập số tự nhiên và thỏa mãn $$f(f(n))=n+1987,$$ với mọi số nguyên dương $n$.\\
Bài tập vừa nêu trên là Bài 4 trong Đề thi Olympic Toán học Quốc tế năm 1987. Theo một nguồn tin với độ tin cậy hơn cả "đáng tin cậy", bài toán đó do Việt Nam đề nghị.\\
Còn không ít điều có thể giãi bày  xung quanh những điều đã được đề cập trong bài viết, tới thời điểm này. Tuy nhiên, vì khuôn khổ của tạp chí có hạn, xin được dừng bài viết tại đây. Với một câu hỏi dành cho bạn đọc có quan tâm: Phải chăng mọi kết quả được đề cập trong bài viết này đều bất di bất dịch, khi tập số nguyên dương được thay thế bởi tập số tự nhiên?
\begin{bt}
	Tìm tất cả các hàm số $f:\mathbb{N}^*\rightarrow\mathbb{N}^*$ thỏa mãn $f(f(n))=n^2$, với mọi số nguyên $n$.
\end{bt}
\noindent Bạn hỏi, vì sao trong lời giải bài toán $1$, người ta xây dựng được hàm $f$, mà không cần tới phân hoạch của tập $\overline{CP}$.\\
Bạn hỏi thì tôi xin thưa, thực ra là có đấy.\\
Với các kí hiệu như trong lời giải 1, ta có $n_k=n_{k,0}$. Do đó, theo công thức xác định hàm $f$ ta có:
\begin{align*}
&f(n_1)=f(n_{1,0})=n_{2,0}=n_2,\\
&f(n_2)=f(n_{2,0})=n_{1,1}=n_1^2,\\
&f(n_3)=f(n_{3,0})=n_{4,0}=n_4,\\
&f(n_4)=f(n_{4,0})=n_{3,1}=n_3^2,\cdots
\end{align*} 
\noindent Như vậy để xây dựng hàm $f$, trước hết ta sắp xếp tất cả các số chính phương theo thứ tự tăng dần $$n_1<n_2<\cdots<n_i<n_{i+1}<\cdots.$$
\noindent Sau đó phân hoạch 
$\overline{CP}=\bigcup\limits_{i=1}^{\infty}\{n_{2i-1};n_{2i}\}$; 
rồi trong mỗi tập con $\{n_{2i-1};n_{2i}\}$, đặt $f(n_{2i-1})=n_{2i}$ và $f(n_{2i})=n_{2i-1}^2$.\\
Với cách phân hoạch và cách dựng hàm $f$ như trên, người ta đã ẩn đi được qui trình xây dựng và đồng thời, lại có thể trình bày lời giải một cách \lq\lq bình dân\rq\rq, thân thiện với học sinh phổ thông thời đó.\\
Bạn hỏi, từ những điều trên đây có thể thấy, về thực chất, chỉ có thể giải được bài toán $1$, nếu giải được bài toán $2$; vậy thì vì sao người ta lại hạn chế yêu cầu như ở bài toán $1$?\\
Theo người viết bài này, rất có thể một phần vì tính trừu tượng của một số điều trong lời giải bài toán $2$. Có lần, người viết bài này có trao đổi với mấy bạn học sinh chuyên Toán cấp THPT về những điều trên đây và các bạn ấy đã thắc mắc $\infty$ có phải số chẵn không mà có thể phân hoạch tập $\overline{CP}$ thành các tập con, mỗi tập có hai phần tử? Bạn có thắc mắc thế không? Nếu có, bạn có thể yên tâm, trong trường hợp này, $\infty$ là \lq\lq số\rq\rq\, chẵn; vì lí do đơn giản, $\infty$ là tư thế nằm ngang của số $8$, mà $8$ là số chẵn nên $\cdots$ $\infty$ phải là \lq\lq số\rq\rq\, chẵn!\\
Chẳng biết có phải vì gặp được \lq\lq ngày lành tháng tốt\rq\rq\,  hay không, mà lúc đang \lq\lq bay bay \rq\rq\, với chiến quả của mình, tôi chợt nhận ra rằng các luận cứ then chốt trong toàn bộ quá trình \lq\lq mày mò\rq\rq, tìm kiếm trên đây, được rút ra từ các tính chất không phải là tính chất đặc thù của hàm số $n^2$. Bạn có nhận thấy như thế? Cảm nhận này, hiển nhiên, là một cú hích mạnh, làm nảy sinh ý đồ phát triển bài toán $2$, bằng cách thay $n^2$, trong phương trình hàm $(1)$, bởi một hàm số $g:\mathbb{N}^*\rightarrow\mathbb{N}^*$ nào đó, có các tính chất tương tự các tính chất mà ta đã khai thác của hàm số $n^2$. Nói cách khác, cảm nhận đó là một cú hích mạnh, xúi giục \textit{tìm hàm số $g:\mathbb{N}^*\rightarrow\mathbb{N}^*$ sao cho bằng cách tương tự cách giải bài toán 2, có thể tìm được tất các các hàm số $f:\mathbb{N}^*\rightarrow\mathbb{N}^*$ thỏa mãn} \[f(f(n))=g(n),\tag{3}\]
\textit{với mọi số nguyên dương $n$.}\\
Để thuận tiện cho việc theo dõi của bạn đọc, xin điểm lại dưới đây các luận cứ then chốt trong cách giải bài toán $2$:
\begin{itemize}
	\item \textbf{Luận cứ 1:} Với $m$ là số chính phương (tức $m\in CP$) tùy ý lớn hơn $1$, luôn tồn tại duy nhất cặp số $(q,k)$, với $q$ là số không chính phương (tức $q\in\overline{CP}$) và $k$ là số nguyên dương, sao cho $m=q^{2^k}$.
	\item \textbf{Luận cứ 2:} Giả sử $f:\mathbb{N}^*\rightarrow\mathbb{N}^*$ là hàm số thỏa mãn $(1)$. Khi đó, với mỗi số $u\in\overline{CP}$, tồn tại duy nhất số $v\in\overline{CP}$ sao cho hoặc $f(u)=v$ và $f(v)=u^2$, hoặc $f(u)=v^2$ và $f(v)=u$.    
\end{itemize}
\noindent Như thế để có thể tìm được tất cả các hàm số $f$ thỏa mãn $(3)$ bằng cách tương tự cách giải bài toán $2$, chí ít ta cần các khẳng định tương tự các luận cứ $1$ và $2$ trên đây, đối với hàm $g$. Để thuận tiện cho việc phát biểu các khẳng định đó, ta kí hiệu: $$G=\{m\in\mathbb{N}^*|\exists n\in\mathbb{N}^*:m=g(n)\}$$ 
và $\overline{G}=\mathbb{N}^*\setminus G$ (nói cách khác, $\overline{G}=\{m\in\mathbb{N}^*|\forall n\in\mathbb{N}^*:m\ne g(n)\}$).\\
Tiếp theo, để ý rằng, với $n\in\mathbb{N}^*$, $n^{2^k}=(n^{2^{k-1}})^2$ và $n^{2^0}=n$, ta quy ước $$g^0(n)=n$$
với mọi $n\in\mathbb{N}^*$, và đặt $g^k(n)=g(g^{k-1}(n))$ với mọi $k,n\in\mathbb{N}^*$.\\
Khi đó, các khẳng định cần có (dưới đây, gọi là yêu cầu) đối với hàm số $g$ được phát biểu như sau: 
\begin{itemize}
	\item \textbf{Yêu cầu 1:} Với $m>1$ tùy ý thuộc $G$, luôn tồn tại duy nhất cặp số $(q,k)$, với $q\in\overline{G}$ và $k$ là số nguyên dương, sao cho $m=g^k(q)$.
	\item \textbf{Yêu cầu 2:} Giả sử $f:\mathbb{N}^*\rightarrow\mathbb{N}^*$ là hàm số thỏa mãn $(3)$. Khi đó, với mỗi số $u\in\overline{G}$, tồn tại duy nhất số $v\in\overline{G}$ sao cho hoặc $f(u)=v$ và $f(v)=g(u)$, hoặc $f(u)=g(v)$ và $f(v)=u$.    
\end{itemize}
\noindent \textit{Câu hỏi đặt ra: Những tính chất nào của hàm số $g$ có thể đảm bảo cho các yêu cầu $1$ và $2$ được thỏa mãn?}\\
Với mạch suy luận đang theo đuổi, hiển nhiên thấy, chỗ dựa để có câu trả lời cho câu hỏi vừa nêu chính là các tính chất (của hàm số $n^2$) dẫn đến các luận cứ $1$ và $2$ trên đây.\\
Rõ ràng, để biết các tính chất của hàm số $n^2$ sinh ra luận cứ $1$, cần căn cứ vào phép chứng minh luận cứ đó. Ta biết rằng luận cứ $1$ có thể được chứng minh như sau:\\
\textit{Chứng minh luận cứ 1:} Xét số nguyên dương $m>1$ tùy ý thuộc $CP$.
\begin{itemize}
	\item Vì $m\in CP$, $m>1$, và do $n<n^2$ với mọi số nguyên dương $n>1$ nên tồn tại $m_1\in\mathbb{N}^*$ và $1<m_1<m$ sao cho $m=m_1^2$.\\
	Nếu $m_1\in\mathbb{N}^*$ thì tương tự trên, tồn tại $m_2\in\mathbb{N}^*$ và $1<m_2<m_1$ sao cho $m_1=m_2^2$.\\
	Tiếp tục quá trình \lq\lq nếu\rq\rq nêu trên, ta sẽ thu được dãy số nguyên dương lớn hơn $1$ 
	\[m>m_1>m_2>\cdots\tag{4}\] 
	thỏa mãn $m_i=m_{i+1}^2$ với mọi $i=0,1,2,\cdots$ (quy ước $m_0=m$).\\
	Vì số số nguyên dương lớn hơn $1$, nhỏ hơn $m$ và thuộc $CP$ là hữu hạn nên dãy $(4)$ là dãy hữu hạn; nghĩa là, quá trình \lq\lq nếu\rq\rq\, phải dừng lại ở một bước nào đó. Rõ ràng, quá trình \lq\lq nếu\rq\rq\, chỉ phải dừng lại khi số thu được là một số thuộc $\overline{CP}$.\\
	Những điều vừa trình bày trên đây cho thấy, tồn tại số nguyên dương $k$ sao cho ta có thể tìm được $k$ số nguyên dương $m_1,\cdots,m_k$ thỏa mãn: $m_k\in\overline{CP}$ và \[m_i=m_{i+1}^2\, \text{với mọi}\, i=0,1,\cdots,k-1\tag{5}\]
	(quy ước $m_0=m$).\\
	Rõ ràng, từ $(5)$, ta có $m=(m_k)^{2^k}$.\\
	Như vậy, ta đã chứng tỏ được rằng, tồn tại cặp số $(q,k)$, với $q\in\overline{CP}$ và $k\in\mathbb{N}^*$, sao cho $m=q^{2^k}$.
	\item Giả sử tồn tại hai cặp số $(q,k)$ và $(p,l)$, với $q,p\in\overline{CP}$ và $k,l\in\mathbb{N}^*$, sao cho \[m=q^{2^k}=p^{2^l}.\tag{6}\]
	Không mất tính tổng quát, có thể giả sử $k\le l$. Khi đó, từ $(6)$, ta có $q=p^{2^{l-k}}$.\\
	Từ đó, vì $q\in\overline{CP}$ nên phải có $2^{k-l}=1$, hay $l=k$; kéo theo $q=p$.\\
	Luận cứ 1 được chứng minh.      
\end{itemize}
Chứng minh trên đây cho thấy luận cứ $1$ được suy ra từ hai tính chất sau của hàm số $n^2$:\\
\noindent \textit{Tính chất 1:} $n<n^2$ với mọi số nguyên dương $n>1$.\\
\textit{Tính chất 2:} $n^2$ là một đơn ánh đi từ $\mathbb{N}^*$ đến $\mathbb{N}^*$. (Tính chất này được sử dụng khi thực hiện phép biến đổi từ $(6)$ về $q=p^{2^{l-k}}$).\\
Tiếp theo, nhìn lại chặng đường đi đến luận cứ $2$, bạn sẽ thấy luận cứ đó cũng được suy ra từ hai tính chất nêu trên của hàm số $n^2$.\\
Những điều vừa trình bày trên đây dẫn ta tới dự đoán: Các yêu cầu $1$ và $2$ đối với hàm số $g$ sẽ được đáp ứng, nếu hàm số đó có các tính chất sau:
\begin{itemize}
	\item $n<g(n)$ với mọi số nguyên dương $n>1$.
	\item $g$ là một đơn ánh từ $\mathbb{N}^*$ đến $\mathbb{N}^*$.
\end{itemize}
\noindent Hiển nhiên, việc cần làm bây giờ là vận nội công để kiểm tra tính đúng của dự đoán nêu trên.